openapi: 3.0.0

info:
  version: '3.2'
  title: arcus API Documentation
  description: |
    # Introduction

    Welcome to arcus! Here you’ll find detailed information for integrating with
    our API endpoints. We’ve tried to make this documentation as user-friendly
    and example-filled as possible, but if you have any questions, please
    [contact us](mailto:support@Regalii.com).

    Integration happens in six easy steps:

    1. Sign NDA
    2. Receive staging (sandbox) API keys
    3. Complete compliance approval
    4. Sign commercial contract
    5. Receive production API keys
    6. Get certified

    ---

    # Our products

    * __xData__ Pull real-time data from billers
    * __xChange__ Push card-on-file updates to billers

    ---

    # Glossary

    * __api-key__ It allows arcus to uniquely identify the user making any
      requests to the APIx.
    * __secret-key__ This key will be generated to give your users a unique
      signature (checksum) for their requests, thus guaranteeing the authenticity.
      Make sure never to expose this.
    * __Bill__ Expenses owed by a user to a biller which need to be paid on
      a recurring basis.
    * __Biller__ Any client that offers a user a service (e.g.: Verizon,
      Uber, Time Warner)
    * __Credentials__ A set of values that gives a user access to a
      biller's website and/or app. E.g.: username + password.
    * __MFA__ Stands for Multi-factor Authentication. Some billers require more
      than just a username/password to log in. In those situations, one or more
      MFA challenges have to be answered. An MFA challenge can be a verification
      code sent to a phone, a secret question, an image, a list of images to
      choose from, or different choices which only the end user would know the
      answer to.
    * __Migration__ It is the act of changing a bill's credit card number.

    ---

    # Environments

    Arcus will provide you with separate API keys for our two existing
    environments:

    * __Sandbox__. Arcus maintains a Sandbox which allows developers to test the
    API using mock data. We recommend keeping in mind the following:

        * The list of billers is not in sync with the billers in production
        * Do not send real credentials to the Sandbox

      To make requests to the sandbox environment, use the following URL:
        `https://apix.staging.arcusapi.com`

    * __Production__. Once you have completed all the necessary tests on the
    sandbox, contact us to receive your production keys.

      To make requests to the production environment, use the following URL:
        `https://apix.arcusapi.com`

      __NOTE:__ For security reasons, it's not possible to make production
      requests through our dynamic documentation.

    ---

    # Security

    To make requests to our endpoints, you must use the `https` protocol,
    regardless of the environment you're using.

    <div class="panel panel-danger">
      <div class="panel-body">
        <h4><strong>Note:</strong> For security reasons, our API doesn't support
        the TLS V1.0 anymore; we recommend you to use TLS v1.2 for better
        security.</h4>
      </div>
    </div>

    > ## Authentication

    > Arcus uses a `public_key` for getting the authentication keys (`api_key`,
    `secret_key`) for a user. This will be provided for your requests to the
    `/public/token` endpoint.

    > Arcus expects the api-key to be included in all API requests (except to
    the `public/token`) in the ‘Authorization’ header, combined with a checksum
    which we will describe later on:

    > __Authorization:__ `APIAuth <your-api-key>:<checksum>`

    * ### Calculating the Checksum

        1. A checksum string needs to be created first by concatenating the
        `Content-Type`, `Content-MD5`, `Endpoint` and today's `Timestamp`:

            checksum_string = `content-type`,`content-md5`,`endpoint`,`timestamp`

              - __Note:__ The ‘Endpoint’ is simply the URL you are sending the
              request to, excluding the server and including the parameters. For
              instance, if you want to obtain a bill's data by requesting a get
              to `https://apix.staging.arcusapi.com/bills/1`, your checksum string
              should look like this:
              `application/json,,/bills/1,Wed, 10 Jan 2017 16:53:15 GMT`
              - __Note:__ Please notice the timestamp format. In UNIX-based
              systems you could obtain it by running:
                <b>echo \`date -Ru | sed 's/+0000/GMT/'`</b> in your terminal.

        2. The checksum string is then used to create the checksum, which is a
        Base64 SHA1 HMAC string encoded using your secret-key.

        3. For testing, verify that if you pass
        `application/json,,/account,Wed, 02 Nov 2016 17:26:52 GMT` to your
        checksum function and use `verify-secret` as secret key, it should
        return `nLet/JEZG9CRXHScwaQ/na4vsKQ=`. See checksum verification
        [example](https://gist.github.com/dagosi/c2e7db228a9c15e2f5bcdccd7a056183).

            How to create a checksum in
            [Bash](https://gist.github.com/dagosi/d85979e364af745750a9dff8c8c5a949):

            ```
            CURRENT_DATE=`date -Ru | sed 's/+0000/GMT/'`
            CHECKSUM=$(echo -n "application/json,,/account,$CURRENT_DATE" \
              | openssl dgst -sha1 -binary -hmac "your-secret-key" \
              | base64)
            ```

    * ### How to use the Checksum

      Now that you have a checksum, you can add it to the `Authorization` header
      as we previously mentioned. As an example, let’s assume that your api-key
      is `f0253d2a6a76ed12499e7878d7803ffb` and that your checksum is
      `nLet/JEZG9CRXHScwaQ/na4vsKQ=`. Now, you can add the following header to
      your request:

      `-H Authorization: APIAuth f0253d2a6a76ed12499e7878d7803ffb:nLet/JEZG9CRXHScwaQ/na4vsKQ=`

    * ### Other headers

      Aside from the Authorization header, you will also have to make sure that
      your requests include the following headers:
        * __Content-MD5__ It can be blank or a hash of digest base64.

          `-H 'Content-MD5: 1B2M2Y8AsgTpgAmY7PhCfg=='`
        * __Date__ It requires the same format used in the generation of the
          checksum.

          `-H 'Date: Tue, 24 Apr 2018 21:04:28 GMT'`
        * __Content-Type__ Always should be application/json

          `-H 'Content-Type: application/json'`
        * __Accept__ Always should be application/vnd.arcus.public.v3.2+jsonn

          `-H 'Accept: application/vnd.arcus.public.v3.2+json'`

    ___

    # Pagination

    For those endpoints that return a list of resources, we have added the
    `X-Pagination` header on the response to make pagination easier. Following
    is an example of its content:

    ```
    X-Pagination: {"total_entries":411,"total_pages":9,"previous_page":null,"current_page":1,"next_page":2}
    ```

    __NOTE:__ This custom header does not appear in the response obtained
    through this documentation
    ___

    # Resources' status

    ## xData

      - __updating__: the process to obtain the bill's information is ongoing
      - __waiting__: an MFA challenge needs to be answered
      - __failed__: something went wrong (more details are given in the error
        JSON object)
      - __updated__: the bill's information has been successfully fetched

    ___

    ## xChange

      - __updating__: migration process started
      - __waiting__: an MFA challenge needs to be answered
      - __failed__: something went wrong (more details are given in the error
        JSON object)
      - __updated__: the card's information was successfully updated

    ___

    # Errors

    Responses will use standard HTTP error codes to convey basic error status
    information.

    Unless you obtain a successful response (code 200), you may encounter any of
    the following:

    <table>
      <tr>
        <th>Error Code</th>
        <th>Meaning</th>
      </tr>
      <tr>
        <td>400</td>
        <td>Bad Request</td>
      </tr>
      <tr>
        <td>401</td>
        <td>Unauthorized -- Your API key or checksum is wrong</td>
      </tr>
      <tr>
        <td>403</td>
        <td>
          Forbidden -- You are not authorized to access the resource requested
        </td>
      </tr>
      <tr>
        <td>404</td>
        <td>Not Found -- The specified resource could not be found</td>
      </tr>
      <tr>
        <td>422</td>
        <td>
          Unprocessable Entity -- You will receive more information on the
          response of what the problem was
        </td>
      </tr>
      <tr>
        <td>429</td>
        <td>
          Too Many Requests -- You're sending too many requests! Slow down!
        </td>
      </tr>
      <tr>
        <td>500</td>
        <td>
          Internal Server Error -- We had a problem with our server. Try again
          later.
        </td>
      </tr>
      <tr>
        <td>503</td>
        <td>Service Unavailable -- Please try again later.</td>
      </tr>
    </table>

    ## Unprocessable entity error codes

    Whenever you get a 422 HTTP error code, we will provide you with extra
    information so that you know what course of action to take in order to
    obtain a successful response.

    <table>
      <tr>
        <th>Error Code</th>
        <th>Message(s) returned</th>
        <th>Recommended action</th>
      </tr>
      <tr>
        <td>R120</td>
        <td>Invalid username or password</td>
        <td>Please review your credentials and try again</td>
      </tr>
      <tr>
        <td>R121</td>
        <td>
          There was a temporary error while connecting, please try again
        </td>
        <td>
          Try again later
        </td>
      </tr>
      <tr>
        <td></td>
        <td>
          The card information was declined by the biller
        </td>
        <td>
          Please review the card's information and try again
        </td>
      </tr>
      <tr>
        <td>R122</td>
        <td>
          Balance not yet available for this biller
        </td>
        <td>
          xData is not available for this biller
        </td>
      </tr>
      <tr>
        <td>R123</td>
        <td>
          The identification answer answered was incorrect <br/>
          Invalid MFA answer
        </td>
        <td>Please review your responses and try again</td>
      </tr>
    </table>

    # Tools for Testing

    It is recommended that you first test a couple of endpoints and get
    familiarized with their responses. This will give you an idea of how to
    properly construct requests in your application (and save you coding time).

    You can do so by using the following dynamic sections of this documentation.
    In order for the endpoints to work properly, first you have to click on the
    `Authorize` button (located before the endpoints, to the right) and enter
    your api-key and secret-key corresponding to the environment you wish to use
    (make sure that the correct environment is selected on the `Server` combo
    box located below and to the left of the `Authorize` button). Alternatively,
    you can click on the 'lock' icon located on each endpoint to enter your
    keys.

    Once you have authenticated, you can now click on each endpoint's
    `Try it out` button, which will let you enter the parameters' values (if
    any) and display a big blue `Execute` button.

    Additionally, you can use any of the following API-testing tools:

      * [Paw](https://paw.cloud/)
      * [Postman](https://www.getpostman.com/)
      * [Insomnia](https://insomnia.rest/)

    ## Handling Multi-factor Authentication (MFA)

    Some billers require more than just a username/password to log in. In
    those situations, arcus will associate one or more MFA challenges with a
    bill. An MFA challenge can be a verification code sent to a phone, a
    secret question, an image, a list of images to choose from, or different
    choices which only the end user would know the answer to. When arcus
    refreshes a bill, it will be set into a status of waiting, which means
    that the end user must answer a challenge.

    ## Forcing errors and MFAs

    Within the Sandbox, we have created a client that will allow you to force
    a failed response as well as test the usage of MFA Challenges:
      - name: Arcus Faker
      - ID: 451cc3f4-68c4-4280-9d8a-164891bbd850

    This can be done by using a specific `login` value in those endpoints that
    create a resource for xData. If you're testing MFA challenge
    behavior, depending on which product you're using you will have to provide
    the fixed answer (see table below) on the corresponding `PATCH` endpoint:
    <b>PATCH/bills/{id}</b> for xData.

    Following is the list of the existing `login` values for testing purposes:

    <table>
      <tr>
        <th>Login value</th>
        <th>Explanation</th>
      </tr>
      <tr>
        <td>question.the_answer</td>
        <td>
          This will associate a new MFA Challenge of type 'question' with the
          bill. Challenge answer: the_answer
          Take into account that `the_answer` can actually be any string you
          want (e.g.: `llama`, `mr alpaca`, `Arcus Fi`, etcetera).
          Once an MFA of this kind is solved, normally it will not be necessary
          to answer it anymore on subsequent calls with the same credentials.
        </td>
      </tr>
      <tr>
        <td>code.the_code</td>
        <td>
          This will associate a new MFA Challenge of type 'code' with the
          bill. Challenge answer: the_code
          Take into account that `the_code` can be any value you want.
          An MFA of this kind will generally be asked each time you send
          credentials.
        </td>
      </tr>
      <tr>
        <td>choice</td>
        <td>
          This will associate a new MFA Challenge of type 'choice' with the
          bill. You will have to select the answer from the choices given in the
          response.
        </td>
      </tr>
      <tr>
        <td>image_url</td>
        <td>
          This will associate a new MFA Challenge of type 'url' with the bill.
          Challenge answer: arcus (you would be able to see this text if you
          were to open the url provided)
        </td>
      </tr>
      <tr>
        <td>credentials</td>
        <td>
          This will return error code <b>R120</b>, HTTP status 422.
        </td>
      </tr>
      <tr>
        <td>input</td>
        <td>
          This will return error code <b>R121</b>, HTTP status 422.
        </td>
      </tr>
      <tr>
        <td>exception</td>
        <td>
          This will return error code <b>R121</b>, HTTP status 500.
        </td>
      </tr>
      <tr>
        <td>unavailable</td>
        <td>
          This will return error code <b>R122</b>, HTTP status 422.
        </td>
      </tr>
    </table>

    __Note:__ We recommend you use a different `password` everytime you create a
      resource in the sandbox.

servers:
  - url: https://apix.staging.arcusapi.com
    description: Sandbox, Mock Credentials; Mock Data

tags:
  - name: Common
    description: Common endpoints
  - name: xData
    description: Access to xData documentation

security:
  - hmacAuth: []

paths:
  /public/token:
    post:
      tags:
        - Common
      summary: Creates an User and his keys
      operationId: createBills
      description: |
        This endpoint creates an user for a specific client.

        When you send the credentials, the user object is created and
        then we return the credentials for the user.
      requestBody:
        description: Within the request body the parameters sent are the
          `public_key` from the client.
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                public_key:
                  type: string
                  description: Client public_key
                  example: "407c1ad16080b52aa55d2ac1cab81a412e25520f765f8e1462b9068194ba463e1dc28a7ddd1ea94e8b33b26db8c1101f1aa57aa7110e45b5a1de50255bc371f3"
              required:
                - public_key
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/User'
              example:
                api_key: 0b4f423d36581cdb541a86e445868787
                secret_key: diiWbYpnfdJUXDVtiAowZmIL2LAl0Neugh8qHzs1i5PzRgRgZFKadF1Pn+sgiWdbVXtZ+fG/ayU4IknfPBUOdg==

  /billers:
    get:
      tags:
        - Common
      summary: Provides the current list of billers
      operationId: getBillersCredentials
      description: |
        This endpoint provides the current list of billers and their associated
        properties.
        To ensure that your end users are able to leverage the enhancements that
        we make over time, you are required to cache the full list of billers
        and update it on a weekly basis.
      parameters:
        - in: query
          name: page
          required: false
          description: It allows you to display any page of the billers' list
          schema:
            type: integer
        - in: query
          name: q[name_eq]
          required: false
          description: Only returns billers whose name matches the value sent
          schema:
            type: string
        - in: query
          name: q[name_cont]
          required: false
          description: Only returns billers whose name contains the value sent
          schema:
            type: string
        - in: query
          name: q[name_start]
          required: false
          description: Only returns billers whose name starts with the value sent
          schema:
            type: string
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                type: object
                properties:
                  billers:
                    type: array
                    items:
                      $ref: '#/components/schemas/Biller'
                example:
                  billers:
                    - type: biller
                      id: 3bc572a9-cb55-4aea-80aa-40b058d26673
                      name: Con Edison
                      country: US
                      currency: USD
                      biller_type: Electricity
                      bill_type: credentials
                      required_parameters: [login,password]
                      returned_parameters: [balance,due_date,account_number,name_on_account,xdata]
                      can_migrate: false
                      charge_user: true
                      has_xdata: false

  /bills:
    post:
      tags:
        - xData
      summary: Creates a bill for a specific  user
      operationId: createBills
      description: |
        This endpoint creates a bill for a specific user.

        When you send the credentials and biller_id to create a bill, the bill
        object is created and we then attempt to fetch the bill from the user.
        Thus no matter what happens (MFA, wrong credentials, biller down, etc),
        the bill object is created.

        Take into account that the request may take up to 59 seconds to return.

        If an error or MFA is returned, update the bill to resolve the issue.

      requestBody:
        description: Within the request body the parameters sent are a
          `biller_id`, `login` and `password`
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/Basic_Credentials'
              type: object
              properties:
                biller_id:
                  type: string
                  description: Biller's UUID
                  example: "0282369b-acd1-4e44-a894-c2a10ea5f8e3"
                login:
                  type: string
                  description: User login value
                  example: "jdoe@successful.ii"
                password:
                  type: string
                  description: User password value
                  example: "HeLl0o1!"
              required:
                - biller_id
                - login
                - password
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/Bill'
    get:
      tags:
        - xData
      summary: Retrieves all your bills
      operationId: getBills
      description: |
        This endpoint retrieves all your bills, paginated on batches of 50
        entries per request. If you send any of the q[] parameters, it will
        return a set of bills that meet the criteria specified.
      parameters:
        - in: query
          name: page
          required: false
          description: It allows you to display any page of your bills's list
          schema:
            type: integer
        - in: query
          name: q[created_at_gteq]
          schema:
            type: string
            items:
              type: string
              format: date-time
          required: false
          description: It will return those bills created after the specified
            timestamp
        - in: query
          name: q[created_at_lteq]
          required: false
          description: It will return those bills created before the specified
            timestamp
          schema:
            type: string
            items:
              type: string
              format: date-time
        - in: query
          name: q[id_in][]
          required: false
          description: It will return the bills whose ids have been specified
          schema:
            type: array
            items:
              type: string
              items:
                type: string
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Bill'
                example:
                  bills:
                    - type: bill
                      id: c5482bbe-0f46-4e30-b660-3b1bb0ea773f
                      biller_id: b44f5c1c-a6b7-4688-8311-080512ca4f1e
                      account_number: 87249256
                      name_on_account: Rita Sporer
                      due_date: '2017-01-29T05:00:00Z'
                      balance: 62.38
                      balance_currency: USD
                      balance_updated_at: '2017-01-17T19:57:56Z'
                      error_code: null
                      error_message: null
                      status: linked
                      migrated_at: null
                      mfa_challenges: []
                    - type: bill
                      id: c5482bbe-0f46-4e30-b660-3b1bb0ea773f
                      biller_id: b44f5c1c-a6b7-4688-8311-080512ca4f1e
                      account_number: 1234567
                      name_on_account: Jose Bautista
                      due_date: null
                      balance: 400
                      balance_currency: RD
                      balance_updated_at: '2017-01-17T21:47:19Z'
                      error_code: null
                      error_message: null
                      status: linked
                      migrated_at: null
                      mfa_challenges: []
  /bills/{id}:
    get:
      tags:
        - xData
      summary: Retrieves a specific bill’s cached data
      operationId: getBill
      description: |
        This endpoint retrieves a specific bill’s cached data. To pull fresh
        data from a biller see `POST /bills/{id}/refresh`
      parameters:
        - name: id
          in: path
          description: UUID of the bill you wish to obtain (this version still
            accepts IDs, but they will be deprecated in future versions)
          required: true
          schema:
            type: string
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/Bill'
    patch:
      tags:
        - xData
      summary: Allows you to update a specific bill's credentials and/or answer
        MFA challenges
      description: |
        This endpoint allows you to update a specific bill's credentials and/or
        answer MFA challenges.

        ## Replying to MFA Challenges

        In order to answer MFA challenges, you must provide the credentials and
        an array named 'mfa_challenges', containing one or more objects
        (depending on how many challenges the biller provided) with the
        following attributes: id, type and response. Make sure that the id and
        type match the mfa_challenge. For more detailed information refer to the
        MFA_Response Model.

        ### Bill's status changes

        * Once the challenge has been answered, arcus will be able to update the
          bill's balance. The bill's status will be set to 'updating'.
        * Once the bill balance has been updated, the bill's status will be set
          to 'updated'.
        * If the response of an mfa_challenge is incorrect OR the response is
          provided after `expires_at` time, then an error will be given and the
          bill's status will be set to 'failed'.

      operationId: updateBill

      parameters:
        - name: id
          in: path
          description: UUID of the bill you wish to update (this version still
            accepts IDs, but they will be deprecated in future versions)
          required: true
          schema:
            type: string
      requestBody:
        description: Within the request body the parameters sent are a `login`,
          `password` and an array of MFA_Response objects.
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/Basic_Credentials'
              type: object
              properties:
                mfa_challenges:
                  type: array
                  description: Responses to MFA Challenges
                  items:
                    $ref: '#/components/schemas/MFA_Response'
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/Bill'
    delete:
      tags:
        - xData
      servers:
        - url: https://apix.staging.arcusapi.com
      summary: Deletes a specific bill
      description: This endpoint deletes a specific bill
      operationId: deleteBill
      parameters:
        - name: id
          in: path
          description: UUID of the bill to be deleted (this version still
            accepts IDs, but they will be deprecated in future versions)
          required: true
          schema:
            type: string
      responses:
        204:
          description: successful response
  /bills/{id}/refresh:
    post:
      tags:
        - xData
      summary: Refreshes a specific bill by polling the biller
      description: |
        This endpoint refreshes a specific bill by polling the biller. It
        responds with the same structure as `POST /bills`.
      operationId: refreshBill
      requestBody:
        description: An empty body needs to be provided
        required: true
        content:
          application/json:
            schema:
              type: object
      parameters:
        - name: id
          in: path
          description: UUID of the bill to be refreshed (this version still
            accepts IDs, but they will be deprecated in future versions)
          required: true
          schema:
            type: string
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/Bill'

  /migrations:
    post:
      tags:
        - xChange
      summary: Replaces the payment method on the biller’s website
      description: |
        This endpoint replaces the payment method on the biller’s website.
      operationId: postMigrations
      requestBody:
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/Basic_Credentials'
              type: object
              required:
                - biller_id
                - cc_first_name
                - cc_last_name
                - cc_country
                - cc_number
                - cc_brand
                - cc_expiry_year
                - cc_address
                - cc_city
                - cc_state
                - cc_type
                - cc_zip
                - cc_security_code
                - cc_expiry_month
              properties:
                biller_id:
                  type: string
                  description: Biller's ID.
                  example: "6ab564f9-4e9d-4b03-96d6-dd9f2c39ec53"
                cc_first_name:
                  type: string
                  description: End user’s first name
                  example: "Elon"
                cc_last_name:
                  type: string
                  description: End user’s last name
                  example: "Musk"
                cc_country:
                  type: string
                  description: Country where the card was issued (US only for
                    the time being)
                  example: "US"
                cc_number:
                  type: string
                  description: Card number
                  example: "5221740002389461"
                cc_type:
                  type: string
                  description: Type of card (credit/debit)
                  example: "credit"
                cc_brand:
                  type: string
                  description: Card's brand (mastercard/visa/american_express)
                  example: "visa"
                cc_expiry_year:
                  type: string
                  description: Card's expiry year (4 digit number)
                  example: "2021"
                cc_expiry_month:
                  type: string
                  description: Card’s expiry month (2 digit number)
                  example: "02"
                cc_security_code:
                  type: string
                  description: Card’s security code (3 or 4 digit number)
                  example: "123"
                cc_address:
                  type: string
                  description: Street name and number
                  example: "351 W 14th St Apt L"
                cc_city:
                  type: string
                  description: City
                  example: "New York"
                cc_state:
                  type: string
                  description: Two letter abbreviation of a US state
                  example: "NY"
                cc_zip:
                  type: string
                  description: Address’ zipcode
                  example: "10014"

      responses:
        202:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/Migration'
    get:
      tags:
        - xChange
      summary: Gets all your attempted migrations
      description: |
        This endpoint is used to get all your attempted migrations.
      operationId: getMigrations
      parameters:
        - name: page
          in: query
          description: It allows you to display any page of the migrations’ list
          required: false
          schema:
            type: integer
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Migration'
                example:
                  migrations:
                    - error_code: null
                      error_message: null
                      id: f06a92d9-d752-470f-b53c-90be4152bf4b
                      status: updated
                      requested_at: '2018-05-30T17:46:01.838Z'
                      migrated_at: '2018-05-30T17:46:02.134Z'
                    - error_code: R120
                      error_message: Invalid username or password
                      id: 1c32b482-df80-4dc9-9049-f349ae170c26
                      status: failed
                      requested_at: '2018-05-30T17:02:46.028Z'
                      migrated_at: '2018-05-30T17:03:00.606Z'
                    - error_code: R121
                      error_message: There was a temporary error while
                        connecting, please try again.
                      id: a73b5831-33dc-4582-9591-d6fdaf95aab5
                      status: failed
                      requested_at: '2018-05-30T17:19:42.688Z'
                      migrated_at: '2018-05-30T17:21:18.382Z'
                    - error_code: R121
                      error_message: The card information was declined by the
                        biller
                      id: e2ea35dc-8abc-4d77-a494-44d30fa1471d
                      status: failed
                      requested_at: '2018-05-30T15:42:33.430Z'
                      migrated_at: '2018-05-30T15:42:54.358Z'

  /migrations/{id}:
    get:
      tags:
        - xChange
      summary: Gets the last migration attempt of a bill
      description: >-
        This endpoint gets the last migration attempt of a bill.
      operationId: getMigration
      parameters:
        - name: id
          in: path
          description: ID of the bill whose migration information you wish to
            obtain
          required: true
          schema:
            type: string
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/Migration'

    patch:
      tags:
        - xChange
      summary: Allows you to update a specific migration's credentials and/or
        answer an MFA challenge
      description: |
        This endpoint allows the resolution of an MFA challenge associated with
        the bill whose migration was requested.
      operationId: updateMigration
      parameters:
        - name: id
          in: path
          description: ID of the bill you wish to update
          required: true
          schema:
            type: string
      requestBody:
        description: Within the request body the parameters sent are `login`,
          `password` and an array with the responses to MFA challenges.
        required: true
        content:
          application/json:
            schema:
              allOf:
                - $ref: '#/components/schemas/Basic_Credentials'
              type: object
              properties:
                mfa_challenges:
                  type: array
                  description: MFA Challenges' responses
                  items:
                    $ref: '#/components/schemas/MFA_Response'
      responses:
        200:
          description: successful response
          content:
            application/vnd.arcus.public.v3.2+json:
              schema:
                $ref: '#/components/schemas/Migration'
    delete:
      tags:
        - xChange
      summary: Deletes a specific migration
      description: This endpoint deletes a specific migration
      operationId: deleteMigration
      parameters:
        - name: id
          in: path
          description: UUID of the migration to be deleted
          required: true
          schema:
            type: string
      responses:
        204:
          description: successful response

components:
  securitySchemes:
    hmacAuth:
      type: http
      scheme: hmac-sha1
  schemas:
    Basic_Credentials:
      description: Includes the basic information to access an end user's
        account
      type: object
      properties:
        login:
          type: string
          description: The account's username/email address/identifier
          example: "jdoe@successful.ii"
        password:
          type: string
          description: The account's password
          example: "HeLl0o1!"
      required:
        - login
        - password

    User:
      type: object
      properties:
        api_key:
          type: string
          description: Api key of the user
        secret_key:
          type: string
          description: Secret key of the user
      example:
        api_key: 0b4f423d36581cdb541a86e445868787
        secret_key: diiWbYpnfdJUXDVtiAowZmIL2LAl0Neugh8qHzs1i5PzRgRgZFKadF1Pn+sgiWdbVXtZ+fG/ayU4IknfPBUOdg==
    Bill:
      type: object
      allOf:
        - $ref: '#/components/schemas/Error_Info'
      properties:
        type:
          type: string
          description: bill
        id:
          type: string
          description: Bill's UUID
        biller_id:
          type: string
          description: Biller's UUID
        account_number:
          type: string
          description: Bill's account number
        name_on_account:
          type: string
          description: Name asociated with the account number
        due_date:
          type: string
          description: Deadline to pay the bill
          format: date
        balance:
          type: number
          description: Bill's balance
        balance_currency:
          type: string
          description: Balance's currency
        balance_updated_at:
          type: string
          description: Timestamp of when the balance was last updated
          format: date-time
        status:
          type: string
          description: Bill's status
        migrated_at:
          type: string
          format: date-time
        mfa_challenges:
          description: Multi-factor authentication (MFA) challenges associated
            with the bill; the array can be empty
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/MFA_Challenge_Question'
              - $ref: '#/components/schemas/MFA_Challenge_Code'
              - $ref: '#/components/schemas/MFA_Challenge_Image'
              - $ref: '#/components/schemas/MFA_Challenge_Image_Choices'
              - $ref: '#/components/schemas/MFA_Challenge_Choices'
      example:
        type: bill
        id: c5482bbe-0f46-4e30-b660-3b1bb0ea773f
        biller_id: ce56e8a6-6162-423f-8dc6-e0ccab5ef70b
        account_number: 4222422244
        name_on_account: Jose Bautista
        due_date: '2016-11-30'
        balance: 56.43
        balance_currency: USD
        balance_updated_at: '2017-01-16T20:12:58Z'
        error_code: null
        error_message: null
        status: updated
        migrated_at: null

    Biller:
      type: object
      properties:
        type:
          type: string
          description: A fixed value of 'biller'
        id:
          type: string
          description: Unique identifier (UUID) of the biller
        name:
          type: string
          description: Biller's name
        country:
          type: string
          description: Biller’s ISO 2 digit country code
        currency:
          type: string
          description: 3 digit ISO currency code of the biller’s
            country
        biller_type:
          type: string
          description: Short description of the biller's type (e.g.
            Television/Internet, electricity, etc.)
        bill_type:
          type: string
          description: Specifies the bill identifier that is used to
            perform queries and payments
        required_parameters:
          type: array
          description: List of parameters required to create a bill
            with this biller
          items:
            type: string
        returned_parameters:
          description: List of returned parameters on a bill by this
            biller
          type: array
          items:
            type: string
        can_migrate:
          description: Determines whether you can use xChange with
            this biller
          type: boolean
        charge_user:
          description: "[deprecated; will be removed in future
            versions]"
          type: boolean
        has_xdata:
          description: Determines whether you can use xData with this
            biller
          type: boolean

    Migration:
      type: object
      allOf:
        - $ref: '#/components/schemas/Error_Info'
      properties:
        id:
          description: ID of the bill whose migration was requested
          type: string
        status:
          description: Migration's status
          type: string
        requested_at:
          description: Timestamp of when the migration was requested
          type: string
        migrated_at:
          description: Timestamp of when the migration succeeded
          type: string
      example:
        error_code: null
        error_message: null
        id: de2a19ff-91d1-4c45-b6c4-cb4abfaa4077
        status: updating
        requested_at: '2018-04-06T18:18:36.144Z'
        migrated_at: null

    Error_Info:
      type: object
      properties:
        error_code:
          description: Error code; null if the request was successful
          type: string
        error_message:
          description: Description of the error encountered; null if the request
            was successful
          type: string

    MFA_Challenge:
      description: Shared information of MFA Challenges
      type: object
      required:
        - type
        - id
        - expires_at
      properties:
        type:
          type: string
          description: Challenge's type (question, code, image, image_choice)
        id:
          type: string
          description: Challenge's UUID
        expires_at:
          type: string
          format: date-time
          description: Delay of expiration; after this timestamp the answer will
            be rejected. It can be null.

    MFA_Challenge_Choices:
      description: Structure of an MFA Challenge of type 'choice'
      allOf:
        - $ref: '#/components/schemas/MFA_Challenge'
        - type: object
          required:
            - prompt
          properties:
            prompt:
              type: array
              description: An array of choices
              items:
                type: object
                properties:
                  id:
                    type: integer
                    description: The ID of the option (basically the index of
                      the array)
                  category:
                    type: string
                    description: Defines the category to which the value belongs
                      (e.g. Phone, Text, E-mail). It can be null
                    example: Phone
                  value:
                    type: string
                    description: A phone number or e-mail address. The same
                      value can be present in different categories
                    example: "+1234567890"

    MFA_Challenge_Code:
      description: Structure of an MFA Challenge of type 'code'. Verification
        codes are sometimes sent to an end user's mobile phone before they are
        able to log in. Verification codes cannot be re-used.
      allOf:
        - $ref: '#/components/schemas/MFA_Challenge'
        - type: object
          required:
            - prompt
          properties:
            prompt:
              type: string
              description: The instructions to show to the owner of the account
              example: Please provide the code sent to your phone.

    MFA_Challenge_Image:
      description: Structure of an MFA Challenge of type 'image'
      allOf:
        - $ref: '#/components/schemas/MFA_Challenge'
        - type: object
          required:
            - prompt
          properties:
            prompt:
              type: object
              properties:
                type:
                  type: string
                  description: "The type of the image: url or uri"
                value:
                  type: string
                  description: The URL of the image for url or the content of
                    the image for uri
                  example: http://via.placeholder.com/350x150

    MFA_Challenge_Image_Choices:
      description: Structure of an MFA Challenge of type 'image_choice'
      allOf:
        - $ref: '#/components/schemas/MFA_Challenge'
        - type: object
          required:
            - prompt
          properties:
            prompt:
              type: array
              description: An array of images
              items:
                type: object
                properties:
                  id:
                    type: integer
                    description: The ID of the option (basically the index of
                      the array)
                  type:
                    type: string
                    description: "The type of the image: url or uri"
                  value:
                    type: string
                    description: The URL of the image for url or the content of
                      the image for uri
                    example: http://via.placeholder.com/350x150

    MFA_Challenge_Question:
      description: Structure of an MFA Challenge of type 'question'. Secret
        questions are often asked in addition to an end user's password.
      allOf:
        - $ref: '#/components/schemas/MFA_Challenge'
        - type: object
          required:
            - prompt
          properties:
            prompt:
              type: string
              description: The question to show to the owner of the account
              example: What is 4 + 4?

    MFA_Response:
      type: object
      required:
        - id
        - type
        - response
      properties:
        id:
          type: string
          description: UUID of the challenge that is being answered
        type:
          type: string
          description: Type of challenge (question, code, image, image_choice)
        response:
          type: string
          description: In the case of type 'code' or 'question', the answer to
            the challenge. In the case of type 'image', the size of the image.
            In the case of 'image_choice' and '?', the ID (index) of the correct
            choice.
